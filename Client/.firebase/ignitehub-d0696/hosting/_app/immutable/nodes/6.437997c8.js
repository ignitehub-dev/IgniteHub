import{s as ee,v as te,h as ne,d as C,r as ie}from"../chunks/scheduler.92391968.js";import{S as se,i as le,d as U,v as ae,u as oe,w as ce,x as ue,f as fe,t as re,y as me,j as T,s as D,k as A,B as G,c as N,l as I,g as v,m as y,C as j,a as P,z as b,M as J,D as z,N as de,o as V,p as E,q as Y}from"../chunks/index.0ef68b7d.js";import{A as x,d as O,u as L,b as q,c as K,w as Q,g as he}from"../chunks/AuthCheck.7db33e3c.js";const{console:_e}=he,R="src/routes/login/username/+page.svelte";function M(n){let e,s,u,i;const t={c:function(){e=T("p"),s=V("Checking availability of @"),u=V(n[0]),i=V("..."),this.h()},l:function(l){e=A(l,"P",{class:!0});var f=I(e);s=E(f,"Checking availability of @"),u=E(f,n[0]),i=E(f,"..."),f.forEach(v),this.h()},h:function(){y(e,"class","text-secondart"),C(e,R,71,4,1857)},m:function(l,f){P(l,e,f),b(e,s),b(e,u),b(e,i)},p:function(l,f){f&1&&Y(u,l[0])},d:function(l){l&&v(e)}};return U("SvelteRegisterBlock",{block:t,id:M.name,type:"if",source:"(66:3) {#if loading}",ctx:n}),t}function F(n){let e,s="must be 3-24 characters long, alphanumeric only.";const u={c:function(){e=T("p"),e.textContent=s,this.h()},l:function(t){e=A(t,"P",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-16fcbfh"&&(e.textContent=s),this.h()},h:function(){y(e,"class","text-error text-sm"),C(e,R,77,4,1983)},m:function(t,a){P(t,e,a)},d:function(t){t&&v(e)}};return U("SvelteRegisterBlock",{block:u,id:F.name,type:"if",source:"(72:3) {#if !isValid && isTouched}",ctx:n}),u}function H(n){let e,s,u,i;const t={c:function(){e=T("p"),s=V("@"),u=V(n[0]),i=V(" is taken."),this.h()},l:function(l){e=A(l,"P",{class:!0});var f=I(e);s=E(f,"@"),u=E(f,n[0]),i=E(f," is taken."),f.forEach(v),this.h()},h:function(){y(e,"class","text-warning text-sm"),C(e,R,83,4,2136)},m:function(l,f){P(l,e,f),b(e,s),b(e,u),b(e,i)},p:function(l,f){f&1&&Y(u,l[0])},d:function(l){l&&v(e)}};return U("SvelteRegisterBlock",{block:t,id:H.name,type:"if",source:"(78:3) {#if isValid && !isAvailable && !loading}",ctx:n}),t}function W(n){let e,s="Confirm Username";const u={c:function(){e=T("button"),e.textContent=s,this.h()},l:function(t){e=A(t,"BUTTON",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1vofb3b"&&(e.textContent=s),this.h()},h:function(){y(e,"class","btn btn-success"),C(e,R,89,4,2240)},m:function(t,a){P(t,e,a)},d:function(t){t&&v(e)}};return U("SvelteRegisterBlock",{block:u,id:W.name,type:"if",source:"(84:3) {#if isAvailable}",ctx:n}),u}function $(n){let e,s="Username",u,i,t,a,l,f,r,g,k,B,m=n[1]&&M(n),d=!n[3]&&n[5]&&F(n),h=n[3]&&!n[2]&&!n[1]&&H(n),_=n[2]&&W(n);const c={c:function(){e=T("h2"),e.textContent=s,u=D(),i=T("form"),t=T("input"),a=D(),l=T("div"),m&&m.c(),f=D(),d&&d.c(),r=D(),h&&h.c(),g=D(),_&&_.c(),this.h()},l:function(o){e=A(o,"H2",{"data-svelte-h":!0}),G(e)!=="svelte-h7fq4i"&&(e.textContent=s),u=N(o),i=A(o,"FORM",{class:!0});var p=I(i);t=A(p,"INPUT",{type:!0,placeholder:!0,class:!0}),a=N(p),l=A(p,"DIV",{class:!0});var w=I(l);m&&m.l(w),f=N(w),d&&d.l(w),r=N(w),h&&h.l(w),g=N(w),_&&_.l(w),w.forEach(v),p.forEach(v),this.h()},h:function(){C(e,R,57,1,1437),y(t,"type","text"),y(t,"placeholder","Username"),y(t,"class","input w-full"),j(t,"input-error",!n[3]&&n[5]),j(t,"input-warning",n[4]),j(t,"input-success",n[2]&&n[3]&&!n[1]),C(t,R,59,2,1522),y(l,"class","my-4 min-h-16 px-8 w-full"),C(l,R,69,2,1796),y(i,"class","w-2/5"),C(i,R,58,1,1456)},m:function(o,p){P(o,e,p),P(o,u,p),P(o,i,p),b(i,t),J(t,n[0]),b(i,a),b(i,l),m&&m.m(l,null),b(l,f),d&&d.m(l,null),b(l,r),h&&h.m(l,null),b(l,g),_&&_.m(l,null),k||(B=[z(t,"input",n[8]),z(t,"input",n[6],!1,!1,!1,!1),z(i,"submit",de(n[7]),!1,!0,!1,!1)],k=!0)},p:function(o,p){p&1&&t.value!==o[0]&&J(t,o[0]),p&40&&j(t,"input-error",!o[3]&&o[5]),p&16&&j(t,"input-warning",o[4]),p&14&&j(t,"input-success",o[2]&&o[3]&&!o[1]),o[1]?m?m.p(o,p):(m=M(o),m.c(),m.m(l,f)):m&&(m.d(1),m=null),!o[3]&&o[5]?d||(d=F(o),d.c(),d.m(l,r)):d&&(d.d(1),d=null),o[3]&&!o[2]&&!o[1]?h?h.p(o,p):(h=H(o),h.c(),h.m(l,g)):h&&(h.d(1),h=null),o[2]?_||(_=W(o),_.c(),_.m(l,null)):_&&(_.d(1),_=null)},d:function(o){o&&(v(e),v(u),v(i)),m&&m.d(),d&&d.d(),h&&h.d(),_&&_.d(),k=!1,ie(B)}};return U("SvelteRegisterBlock",{block:c,id:$.name,type:"slot",source:"(52:0) <AuthCheck>",ctx:n}),c}function Z(n){let e,s;e=new x({props:{$$slots:{default:[$]},$$scope:{ctx:n}},$$inline:!0});const u={c:function(){oe(e.$$.fragment)},l:function(t){ce(e.$$.fragment,t)},m:function(t,a){ue(e,t,a),s=!0},p:function(t,[a]){const l={};a&2111&&(l.$$scope={dirty:a,ctx:t}),e.$set(l)},i:function(t){s||(fe(e.$$.fragment,t),s=!0)},o:function(t){re(e.$$.fragment,t),s=!1},d:function(t){me(e,t)}};return U("SvelteRegisterBlock",{block:u,id:Z.name,type:"component",source:"",ctx:n}),u}const X=/^(?=[a-zA-Z0-9._]{3,24}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function pe(n,e,s){let u,i,t,a;te(L,"user"),ne(n,L,c=>s(10,a=c));let{$$slots:l={},$$scope:f}=e;ae("Page",l,[]);let r="",g=!1,k=!1,B;async function m(){s(2,k=!1),clearTimeout(B),s(1,g=!0),B=setTimeout(async()=>{console.log(`checking availability of ${r}`);const c=q(O,"usernames",r),S=await K(c).then(o=>o.exists());s(2,k=!S),s(1,g=!1)},350)}async function d(){console.log("confirming username",r);const c=Q(O);c.set(q(O,"usernames",r),{uid:a==null?void 0:a.uid}),c.set(q(O,"users",a),{username:r,photoURL:(a==null?void 0:a.photoURL)??null,published:!0,bio:"I am the Walrus",links:[{title:"Test",url:"google.com",icon:"custom"}]}),await c.commit(),s(0,r=""),s(2,k=!1)}const h=[];Object.keys(e).forEach(c=>{!~h.indexOf(c)&&c.slice(0,2)!=="$$"&&c!=="slot"&&_e.warn(`<Page> was created with unknown prop '${c}'`)});function _(){r=this.value,s(0,r)}return n.$capture_state=()=>({AuthCheck:x,db:O,user:L,doc:q,getDoc:K,writeBatch:Q,username:r,loading:g,isAvailable:k,deboundeTimer:B,re:X,checkAvailability:m,confirmUsername:d,isValid:u,isTaken:t,isTouched:i,$user:a}),n.$inject_state=c=>{"username"in c&&s(0,r=c.username),"loading"in c&&s(1,g=c.loading),"isAvailable"in c&&s(2,k=c.isAvailable),"deboundeTimer"in c&&(B=c.deboundeTimer),"isValid"in c&&s(3,u=c.isValid),"isTaken"in c&&s(4,t=c.isTaken),"isTouched"in c&&s(5,i=c.isTouched)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&1&&s(3,u=(r==null?void 0:r.length)>2&&r.length<24&&X.test(r)),n.$$.dirty&1&&s(5,i=r.length>0),n.$$.dirty&14&&s(4,t=u&&!k&&!g)},[r,g,k,u,t,i,m,d,_]}class ve extends se{constructor(e){super(e),le(this,e,pe,Z,ee,{}),U("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Z.name})}}export{ve as component};
